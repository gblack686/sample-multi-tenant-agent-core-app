{
  "type": "excalidraw",
  "version": 2,
  "source": "https://excalidraw.com",
  "elements": [
    {
      "id": "title",
      "type": "text",
      "x": 450,
      "y": 20,
      "width": 400,
      "height": 45,
      "text": "Chat V2 Multi-Agent Architecture",
      "fontSize": 32,
      "fontFamily": 2,
      "textAlign": "center",
      "baseline": 32,
      "strokeColor": "#1e1e1e",
      "backgroundColor": "transparent",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roughness": 1,
      "opacity": 100,
      "seed": 1001
    },
    {
      "id": "subtitle",
      "type": "text",
      "x": 450,
      "y": 70,
      "width": 400,
      "height": 25,
      "text": "Dynamic Agent Loading from PostgreSQL",
      "fontSize": 18,
      "fontFamily": 2,
      "textAlign": "center",
      "baseline": 18,
      "strokeColor": "#868e96",
      "backgroundColor": "transparent",
      "fillStyle": "solid",
      "strokeWidth": 1,
      "roughness": 1,
      "opacity": 100,
      "seed": 1002
    },
    {
      "id": "version-info",
      "type": "text",
      "x": 450,
      "y": 100,
      "width": 400,
      "height": 20,
      "text": "v1.0.0 | Created: 2026-01-20",
      "fontSize": 14,
      "fontFamily": 2,
      "textAlign": "center",
      "baseline": 14,
      "strokeColor": "#868e96",
      "backgroundColor": "transparent",
      "fillStyle": "solid",
      "strokeWidth": 1,
      "roughness": 1,
      "opacity": 100,
      "seed": 1003
    },

    {
      "id": "section-v1-label",
      "type": "text",
      "x": 120,
      "y": 140,
      "width": 200,
      "height": 30,
      "text": "V1: /tools/chat (Default)",
      "fontSize": 20,
      "fontFamily": 2,
      "textAlign": "center",
      "baseline": 20,
      "strokeColor": "#868e96",
      "backgroundColor": "transparent",
      "fillStyle": "solid",
      "strokeWidth": 1,
      "roughness": 1,
      "opacity": 100,
      "seed": 2001
    },
    {
      "id": "v1-box",
      "type": "rectangle",
      "x": 50,
      "y": 180,
      "width": 340,
      "height": 280,
      "strokeColor": "#868e96",
      "backgroundColor": "#f8f9fa",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roughness": 1,
      "opacity": 100,
      "seed": 2002,
      "roundness": { "type": 3 }
    },
    {
      "id": "v1-url",
      "type": "rectangle",
      "x": 70,
      "y": 200,
      "width": 300,
      "height": 40,
      "strokeColor": "#1971c2",
      "backgroundColor": "#e7f5ff",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roughness": 1,
      "opacity": 100,
      "seed": 2003,
      "roundness": { "type": 3 }
    },
    {
      "id": "v1-url-text",
      "type": "text",
      "x": 90,
      "y": 210,
      "width": 260,
      "height": 22,
      "text": "/tools/chat",
      "fontSize": 16,
      "fontFamily": 3,
      "textAlign": "center",
      "baseline": 16,
      "strokeColor": "#1971c2",
      "backgroundColor": "transparent",
      "fillStyle": "solid",
      "strokeWidth": 1,
      "roughness": 1,
      "opacity": 100,
      "seed": 2004
    },
    {
      "id": "v1-arrow1",
      "type": "arrow",
      "x": 220,
      "y": 245,
      "width": 0,
      "height": 30,
      "strokeColor": "#868e96",
      "backgroundColor": "transparent",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roughness": 1,
      "opacity": 100,
      "seed": 2005,
      "points": [[0, 0], [0, 30]]
    },
    {
      "id": "v1-config",
      "type": "rectangle",
      "x": 70,
      "y": 280,
      "width": 300,
      "height": 50,
      "strokeColor": "#e67700",
      "backgroundColor": "#fff3bf",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roughness": 1,
      "opacity": 100,
      "seed": 2006,
      "roundness": { "type": 3 }
    },
    {
      "id": "v1-config-text",
      "type": "text",
      "x": 90,
      "y": 290,
      "width": 260,
      "height": 30,
      "text": "config.js\n(Hardcoded Ada Prompt)",
      "fontSize": 14,
      "fontFamily": 2,
      "textAlign": "center",
      "baseline": 14,
      "strokeColor": "#e67700",
      "backgroundColor": "transparent",
      "fillStyle": "solid",
      "strokeWidth": 1,
      "roughness": 1,
      "opacity": 100,
      "seed": 2007
    },
    {
      "id": "v1-arrow2",
      "type": "arrow",
      "x": 220,
      "y": 335,
      "width": 0,
      "height": 30,
      "strokeColor": "#868e96",
      "backgroundColor": "transparent",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roughness": 1,
      "opacity": 100,
      "seed": 2008,
      "points": [[0, 0], [0, 30]]
    },
    {
      "id": "v1-indexeddb",
      "type": "rectangle",
      "x": 70,
      "y": 370,
      "width": 300,
      "height": 50,
      "strokeColor": "#2f9e44",
      "backgroundColor": "#d3f9d8",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roughness": 1,
      "opacity": 100,
      "seed": 2009,
      "roundness": { "type": 3 }
    },
    {
      "id": "v1-indexeddb-text",
      "type": "text",
      "x": 90,
      "y": 380,
      "width": 260,
      "height": 30,
      "text": "IndexedDB (Client)\narti-conv-{email}",
      "fontSize": 14,
      "fontFamily": 2,
      "textAlign": "center",
      "baseline": 14,
      "strokeColor": "#2f9e44",
      "backgroundColor": "transparent",
      "fillStyle": "solid",
      "strokeWidth": 1,
      "roughness": 1,
      "opacity": 100,
      "seed": 2010
    },
    {
      "id": "v1-note",
      "type": "text",
      "x": 70,
      "y": 430,
      "width": 300,
      "height": 20,
      "text": "Single agent, visible in nav",
      "fontSize": 12,
      "fontFamily": 2,
      "textAlign": "center",
      "baseline": 12,
      "strokeColor": "#868e96",
      "backgroundColor": "transparent",
      "fillStyle": "solid",
      "strokeWidth": 1,
      "roughness": 1,
      "opacity": 100,
      "seed": 2011
    },

    {
      "id": "section-v2-label",
      "type": "text",
      "x": 580,
      "y": 140,
      "width": 300,
      "height": 30,
      "text": "V2: /tools/chat-v2?agentId=X",
      "fontSize": 20,
      "fontFamily": 2,
      "textAlign": "center",
      "baseline": 20,
      "strokeColor": "#1971c2",
      "backgroundColor": "transparent",
      "fillStyle": "solid",
      "strokeWidth": 1,
      "roughness": 1,
      "opacity": 100,
      "seed": 3001
    },
    {
      "id": "v2-box",
      "type": "rectangle",
      "x": 450,
      "y": 180,
      "width": 460,
      "height": 500,
      "strokeColor": "#1971c2",
      "backgroundColor": "#e7f5ff",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roughness": 1,
      "opacity": 100,
      "seed": 3002,
      "roundness": { "type": 3 }
    },
    {
      "id": "v2-url",
      "type": "rectangle",
      "x": 470,
      "y": 200,
      "width": 420,
      "height": 40,
      "strokeColor": "#1971c2",
      "backgroundColor": "#ffffff",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roughness": 1,
      "opacity": 100,
      "seed": 3003,
      "roundness": { "type": 3 }
    },
    {
      "id": "v2-url-text",
      "type": "text",
      "x": 490,
      "y": 210,
      "width": 380,
      "height": 22,
      "text": "/tools/chat-v2?agentId=3&threadId=5",
      "fontSize": 16,
      "fontFamily": 3,
      "textAlign": "center",
      "baseline": 16,
      "strokeColor": "#1971c2",
      "backgroundColor": "transparent",
      "fillStyle": "solid",
      "strokeWidth": 1,
      "roughness": 1,
      "opacity": 100,
      "seed": 3004
    },
    {
      "id": "v2-arrow1",
      "type": "arrow",
      "x": 680,
      "y": 245,
      "width": 0,
      "height": 25,
      "strokeColor": "#1971c2",
      "backgroundColor": "transparent",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roughness": 1,
      "opacity": 100,
      "seed": 3005,
      "points": [[0, 0], [0, 25]]
    },
    {
      "id": "v2-useagent",
      "type": "rectangle",
      "x": 470,
      "y": 275,
      "width": 420,
      "height": 50,
      "strokeColor": "#9c36b5",
      "backgroundColor": "#f3d9fa",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roughness": 1,
      "opacity": 100,
      "seed": 3006,
      "roundness": { "type": 3 }
    },
    {
      "id": "v2-useagent-text",
      "type": "text",
      "x": 490,
      "y": 285,
      "width": 380,
      "height": 30,
      "text": "useAgent({ agentId, threadId }, db)\nhooks.js:286",
      "fontSize": 14,
      "fontFamily": 2,
      "textAlign": "center",
      "baseline": 14,
      "strokeColor": "#9c36b5",
      "backgroundColor": "transparent",
      "fillStyle": "solid",
      "strokeWidth": 1,
      "roughness": 1,
      "opacity": 100,
      "seed": 3007
    },
    {
      "id": "v2-arrow2",
      "type": "arrow",
      "x": 680,
      "y": 330,
      "width": 0,
      "height": 25,
      "strokeColor": "#1971c2",
      "backgroundColor": "transparent",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roughness": 1,
      "opacity": 100,
      "seed": 3008,
      "points": [[0, 0], [0, 25]]
    },
    {
      "id": "v2-adapter-box",
      "type": "rectangle",
      "x": 470,
      "y": 360,
      "width": 420,
      "height": 80,
      "strokeColor": "#e67700",
      "backgroundColor": "#fff3bf",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roughness": 1,
      "opacity": 100,
      "seed": 3009,
      "roundness": { "type": 3 }
    },
    {
      "id": "v2-adapter-text",
      "type": "text",
      "x": 490,
      "y": 370,
      "width": 380,
      "height": 60,
      "text": "Database Adapter Factory\ngetDB(type) → ServerAdapter | IndexedDBAdapter\nDefault: Server with IndexedDB fallback",
      "fontSize": 14,
      "fontFamily": 2,
      "textAlign": "center",
      "baseline": 14,
      "strokeColor": "#e67700",
      "backgroundColor": "transparent",
      "fillStyle": "solid",
      "strokeWidth": 1,
      "roughness": 1,
      "opacity": 100,
      "seed": 3010
    },
    {
      "id": "v2-arrow3",
      "type": "arrow",
      "x": 680,
      "y": 445,
      "width": 0,
      "height": 25,
      "strokeColor": "#1971c2",
      "backgroundColor": "transparent",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roughness": 1,
      "opacity": 100,
      "seed": 3011,
      "points": [[0, 0], [0, 25]]
    },
    {
      "id": "v2-api",
      "type": "rectangle",
      "x": 470,
      "y": 475,
      "width": 420,
      "height": 60,
      "strokeColor": "#d9480f",
      "backgroundColor": "#ffe8cc",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roughness": 1,
      "opacity": 100,
      "seed": 3012,
      "roundness": { "type": 3 }
    },
    {
      "id": "v2-api-text",
      "type": "text",
      "x": 490,
      "y": 485,
      "width": 380,
      "height": 40,
      "text": "REST API: /api/agents, /api/threads, /api/messages\nserver/services/routes/conversations.js",
      "fontSize": 14,
      "fontFamily": 2,
      "textAlign": "center",
      "baseline": 14,
      "strokeColor": "#d9480f",
      "backgroundColor": "transparent",
      "fillStyle": "solid",
      "strokeWidth": 1,
      "roughness": 1,
      "opacity": 100,
      "seed": 3013
    },
    {
      "id": "v2-arrow4",
      "type": "arrow",
      "x": 680,
      "y": 540,
      "width": 0,
      "height": 25,
      "strokeColor": "#1971c2",
      "backgroundColor": "transparent",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roughness": 1,
      "opacity": 100,
      "seed": 3014,
      "points": [[0, 0], [0, 25]]
    },
    {
      "id": "v2-postgres",
      "type": "rectangle",
      "x": 470,
      "y": 570,
      "width": 420,
      "height": 90,
      "strokeColor": "#2f9e44",
      "backgroundColor": "#d3f9d8",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roughness": 1,
      "opacity": 100,
      "seed": 3015,
      "roundness": { "type": 3 }
    },
    {
      "id": "v2-postgres-text",
      "type": "text",
      "x": 490,
      "y": 580,
      "width": 380,
      "height": 70,
      "text": "PostgreSQL (Server)\nAgent { id, name, systemPrompt, tools, userId }\nThread { id, agentId, name }\nMessage { id, threadId, role, content }",
      "fontSize": 13,
      "fontFamily": 2,
      "textAlign": "center",
      "baseline": 13,
      "strokeColor": "#2f9e44",
      "backgroundColor": "transparent",
      "fillStyle": "solid",
      "strokeWidth": 1,
      "roughness": 1,
      "opacity": 100,
      "seed": 3016
    },

    {
      "id": "eagle-box",
      "type": "rectangle",
      "x": 950,
      "y": 200,
      "width": 280,
      "height": 220,
      "strokeColor": "#c92a2a",
      "backgroundColor": "#ffe3e3",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roughness": 1,
      "opacity": 100,
      "seed": 4001,
      "roundness": { "type": 3 }
    },
    {
      "id": "eagle-title",
      "type": "text",
      "x": 970,
      "y": 215,
      "width": 240,
      "height": 25,
      "text": "EAGLE Agent (agentId=3)",
      "fontSize": 18,
      "fontFamily": 2,
      "textAlign": "center",
      "baseline": 18,
      "strokeColor": "#c92a2a",
      "backgroundColor": "transparent",
      "fillStyle": "solid",
      "strokeWidth": 1,
      "roughness": 1,
      "opacity": 100,
      "seed": 4002
    },
    {
      "id": "eagle-details",
      "type": "text",
      "x": 970,
      "y": 250,
      "width": 240,
      "height": 150,
      "text": "{\n  id: 3,\n  name: \"EAGLE\",\n  systemPrompt: \"You are an\n    acquisition specialist...\",\n  tools: [\"search\", \"browse\",\n    \"data\", \"think\"],\n  userId: null (global)\n}",
      "fontSize": 13,
      "fontFamily": 3,
      "textAlign": "left",
      "baseline": 13,
      "strokeColor": "#c92a2a",
      "backgroundColor": "transparent",
      "fillStyle": "solid",
      "strokeWidth": 1,
      "roughness": 1,
      "opacity": 100,
      "seed": 4003
    },
    {
      "id": "eagle-arrow",
      "type": "arrow",
      "x": 895,
      "y": 310,
      "width": 50,
      "height": 0,
      "strokeColor": "#c92a2a",
      "backgroundColor": "transparent",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roughness": 1,
      "opacity": 100,
      "seed": 4004,
      "points": [[0, 0], [50, 0]]
    },
    {
      "id": "eagle-url-example",
      "type": "text",
      "x": 950,
      "y": 430,
      "width": 280,
      "height": 40,
      "text": "Ryan's Link:\nresearchoptimizer-dev.cancer.gov\n/tools/chat-v2?agentId=3",
      "fontSize": 12,
      "fontFamily": 3,
      "textAlign": "center",
      "baseline": 12,
      "strokeColor": "#c92a2a",
      "backgroundColor": "transparent",
      "fillStyle": "solid",
      "strokeWidth": 1,
      "roughness": 1,
      "opacity": 100,
      "seed": 4005
    },

    {
      "id": "flow-label",
      "type": "text",
      "x": 580,
      "y": 700,
      "width": 300,
      "height": 25,
      "text": "System Prompt Loading Flow",
      "fontSize": 18,
      "fontFamily": 2,
      "textAlign": "center",
      "baseline": 18,
      "strokeColor": "#1e1e1e",
      "backgroundColor": "transparent",
      "fillStyle": "solid",
      "strokeWidth": 1,
      "roughness": 1,
      "opacity": 100,
      "seed": 5001
    },
    {
      "id": "flow-box",
      "type": "rectangle",
      "x": 100,
      "y": 730,
      "width": 1100,
      "height": 80,
      "strokeColor": "#1971c2",
      "backgroundColor": "#e7f5ff",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roughness": 1,
      "opacity": 100,
      "seed": 5002,
      "roundness": { "type": 3 }
    },
    {
      "id": "flow-text",
      "type": "text",
      "x": 120,
      "y": 745,
      "width": 1060,
      "height": 50,
      "text": "URL ?agentId=3  →  db.getAgent(3)  →  record.systemPrompt  →  if null → fallback to config.js (Ada)  →  Bedrock API\n\nAgent-specific tools loaded: record.tools.filter(t => TOOLS.includes(t))",
      "fontSize": 14,
      "fontFamily": 2,
      "textAlign": "center",
      "baseline": 14,
      "strokeColor": "#1971c2",
      "backgroundColor": "transparent",
      "fillStyle": "solid",
      "strokeWidth": 1,
      "roughness": 1,
      "opacity": 100,
      "seed": 5003
    },

    {
      "id": "key-diff-label",
      "type": "text",
      "x": 580,
      "y": 830,
      "width": 300,
      "height": 25,
      "text": "Key Differences",
      "fontSize": 18,
      "fontFamily": 2,
      "textAlign": "center",
      "baseline": 18,
      "strokeColor": "#1e1e1e",
      "backgroundColor": "transparent",
      "fillStyle": "solid",
      "strokeWidth": 1,
      "roughness": 1,
      "opacity": 100,
      "seed": 6001
    },
    {
      "id": "key-diff-box",
      "type": "rectangle",
      "x": 100,
      "y": 860,
      "width": 1100,
      "height": 100,
      "strokeColor": "#495057",
      "backgroundColor": "#f8f9fa",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roughness": 1,
      "opacity": 100,
      "seed": 6002,
      "roundness": { "type": 3 }
    },
    {
      "id": "key-diff-text",
      "type": "text",
      "x": 120,
      "y": 875,
      "width": 1060,
      "height": 70,
      "text": "V1: Hardcoded prompt (config.js) | Client-only IndexedDB | Single Ada agent | Visible in nav\nV2: Dynamic prompt (PostgreSQL) | Server storage | Multiple agents via agentId | Hidden route\n\nEAGLE uses V2 with agentId=3 → Dynamic system prompt loaded from database",
      "fontSize": 14,
      "fontFamily": 2,
      "textAlign": "center",
      "baseline": 14,
      "strokeColor": "#495057",
      "backgroundColor": "transparent",
      "fillStyle": "solid",
      "strokeWidth": 1,
      "roughness": 1,
      "opacity": 100,
      "seed": 6003
    }
  ],
  "appState": {
    "viewBackgroundColor": "#ffffff",
    "gridSize": null
  }
}
